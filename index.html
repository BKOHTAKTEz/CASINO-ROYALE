<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS:GO Case Battle</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0; padding: 20px; background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white; font-family: -apple-system, sans-serif; min-height: 100vh;
        }
        .container { max-width: 400px; margin: 0 auto; }
        .header {
            text-align: center; background: rgba(255,255,255,0.1); padding: 20px; 
            border-radius: 20px; margin-bottom: 20px;
        }
        #balance { font-size: 28px; font-weight: bold; color: #00ff88; }
        .game-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;
        }
        .game-card {
            background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; 
            text-align: center; cursor: pointer; transition: all 0.3s;
        }
        .game-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,255,136,0.3); }
        .game-icon { font-size: 40px; margin-bottom: 10px; }
        
        .case-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 10px; }
        .case-btn {
            padding: 15px; border: none; border-radius: 15px; font-weight: bold; 
            color: white; cursor: pointer; transition: all 0.3s;
        }
        .daily { background: linear-gradient(45deg, gold, orange); }
        .bravo { background: linear-gradient(45deg, #4a90e2, #357abd); }
        .classified { background: linear-gradient(45deg, orange, red); }
        .mythic { background: linear-gradient(45deg, purple, #8e44ad); }
        
        .rocket-section { text-align: center; }
        #multiplier { font-size: 48px; font-weight: bold; margin: 20px 0; }
        .controls { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
        .btn {
            flex: 1; padding: 15px; border: none; border-radius: 20px; 
            font-weight: bold; cursor: pointer; transition: all 0.3s;
        }
        .btn-primary { background: linear-gradient(45deg, #00ff88, #00cc6a); color: #000; }
        .btn-cashout { background: linear-gradient(45deg, gold, orange); color: #000; font-size: 18px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        #status { text-align: center; padding: 20px; font-size: 18px; font-weight: bold; }
        canvas { width: 100%; height: 250px; border-radius: 15px; display: none; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div id="balance">üí∞ 100.0 –º–æ–Ω–µ—Ç</div>
        </div>
        
        <div class="game-grid" id="mainMenu">
            <div class="game-card" onclick="showCases()">
                <div class="game-icon">üîì</div>
                <div>–ö–ï–ô–°–´</div>
            </div>
            <div class="game-card" onclick="showRocket()">
                <div class="game-icon">üöÄ</div>
                <div>–†–ê–ö–ï–¢–ö–ê</div>
            </div>
        </div>
        
        <div id="casesSection" style="display:none;">
            <div class="case-grid">
                <button class="case-btn daily" onclick="openCase('Daily')">üéÅ Daily<br>0üí∞</button>
                <button class="case-btn bravo" onclick="openCase('Bravo')">üîµ Bravo<br>10üí∞</button>
                <button class="case-btn classified" onclick="openCase('Classified')">üü° Classified<br>50üí∞</button>
                <button class="case-btn mythic" onclick="openCase('Mythic')">üî¥ Mythic<br>500üí∞</button>
            </div>
            <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="showMain()">üè† –ì–ª–∞–≤–Ω–æ–µ</button>
        </div>
        
        <div id="rocketSection" style="display:none;">
            <div class="rocket-section">
                <div id="multiplier">1.00x</div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="setStake(10)">10üí∞</button>
                    <button class="btn btn-primary" onclick="setStake(50)">50üí∞</button>
                    <button class="btn btn-primary" onclick="setStake(100)">100üí∞</button>
                </div>
                <div class="controls">
                    <button class="btn btn-cashout" id="cashoutBtn" onclick="cashout()" disabled>üí∞ –ö–≠–®–ê–£–¢</button>
                    <button class="btn btn-primary" onclick="startRocket()" id="startBtn">üöÄ –°–¢–ê–†–¢</button>
                </div>
            </div>
            <canvas id="rocketCanvas"></canvas>
            <button class="btn btn-primary" style="width:100%;" onclick="showMain()">üè† –ì–ª–∞–≤–Ω–æ–µ</button>
        </div>
        
        <div id="status">–ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ!</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText('üè† –ì–õ–ê–í–ù–û–ï').onClick(showMain).show();
        
        let balance = 100, currentStake = 0, gameState = 'menu';
        let canvas, ctx, crashPoint = 1, currentMult = 1;
        const userId = tg.initDataUnsafe.user.id;
        
        // API
        async function apiCall(action, data) {
            const response = await tg.sendData(JSON.stringify({action, ...data, user_id: userId}));
            updateBalance();
            return response;
        }
        
        // Update balance
        async function updateBalance() {
            // Mock –¥–ª—è demo - –≤ —Ä–µ–∞–ª–µ –¥–µ–ª–∞–π fetch –∫ —Ç–≤–æ–µ–º—É API
            balance += (Math.random()-0.5)*5;
            document.getElementById('balance').textContent = `üí∞ ${Math.max(0,balance).toFixed(1)} –º–æ–Ω–µ—Ç`;
        }
        setInterval(updateBalance, 3000);
        
        // Navigation
        function showMain() {
            document.getElementById('mainMenu').style.display = 'grid';
            document.getElementById('casesSection').style.display = 'none';
            document.getElementById('rocketSection').style.display = 'none';
            tg.MainButton.show();
        }
        
        function showCases() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('casesSection').style.display = 'block';
            document.getElementById('rocketSection').style.display = 'none';
            tg.MainButton.hide();
        }
        
        function showRocket() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('casesSection').style.display = 'none';
            document.getElementById('rocketSection').style.display = 'block';
            canvas = document.getElementById('rocketCanvas');
            ctx = canvas.getContext('2d');
            canvas.width = 380; canvas.height = 250;
            canvas.style.display = 'block';
            tg.MainButton.hide();
        }
        
        // –ö–ï–ô–°–´ - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –±–æ—Ç
        async function openCase(caseName) {
            document.getElementById('status').textContent = 'üîí –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–µ–π—Å...';
            await apiCall('open_case', {case_name: caseName});
            document.getElementById('status').textContent = '‚ú® –ö–ï–ô–° –û–¢–ö–†–´–¢!';
            setTimeout(showMain, 1500);
        }
        
        // –†–ê–ö–ï–¢–ö–ê
        function setStake(amount) {
            currentStake = amount;
            document.getElementById('multiplier').textContent = `${amount}üí∞ | 1.00x`;
        }
        
        async function startRocket() {
            if (!currentStake || balance < currentStake) {
                tg.showAlert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
                return;
            }
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('cashoutBtn').disabled = false;
            crashPoint = Math.max(1.01, 1 / (Math.random() * 0.99 + 0.01));
            currentMult = 1.0;
            gameState = 'flying';
            
            animateRocket();
        }
        
        function cashout() {
            apiCall('rocket_cashout', {stake: currentStake, multiplier: currentMult});
            gameState = 'cashed';
            document.getElementById('cashoutBtn').disabled = true;
            setTimeout(() => {
                document.getElementById('startBtn').disabled = false;
                document.getElementById('multiplier').textContent = '1.00x';
            }, 2000);
        }
        
        // Canvas rocket animation
        let raf;
        function animateRocket() {
            if (gameState !== 'flying') return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            currentMult += 0.08;
            
            // Rocket
            const x = canvas.width / 2;
            const y = Math.max(50, 200 - currentMult * 10);
            
            ctx.fillStyle = currentMult > 2 ? '#ff4444' : '#00ff88';
            ctx.beginPath();
            ctx.moveTo(x-10, y+20);
            ctx.lineTo(x, y-30);
            ctx.lineTo(x+10, y+20);
            ctx.fill();
            
            // Update UI
            document.getElementById('multiplier').textContent = `${currentMult.toFixed(2)}x`;
            
            if (currentMult >= crashPoint) {
                gameState = 'crashed';
                document.getElementById('multiplier').textContent = `üí• ${crashPoint.toFixed(2)}x`;
                document.getElementById('cashoutBtn').disabled = true;
                document.getElementById('startBtn').disabled = false;
                return;
            }
            
            raf = requestAnimationFrame(animateRocket);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            tg.ready();
            updateBalance();
        });
    </script>
</body>
</html>
